<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop Catalog</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <script src="NAVBAR.JS" defer></script>
    <script src="footer.js"></script>
    <script src="newsletter.js" defer></script>
    <script src="customer-chatbot.js" defer></script>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="customer-chatbot.css">
</head>

<body>
    <div id="navbar-container"></div>

    <section id="page-header">
        <h2>#G&G'S GROVE</h2>
        <p>Get the best products at the best prices</p>
    </section>

    <section id="category-filter">
        <label for="category-select">Filter by Category:</label>
        <select id="category-select">
            <option value="all">All</option>
            <option value="shirt">Shirt</option>
              <option value="Watch">Watch</option>
            <option value="bag">Bag</option>
            <option value="jacket">Jacket</option>
            <option value="shoes">Shoes</option>
            <option value="cap">Cap</option>
        </select>
    </section>

    <section id="product1" class="section-p1">
        <div class="product-box"></div>  
    </section>

    <section id="pagination"></section>

  <div id="newsletter-container"></div>

    <div id='footer-container'></div>

    <script>
        let currentPage = 1;
        const productsPerPage = 12; // Show 10 products per page
        let allProducts = []; // Store all products
        let filteredProducts = []; // Store filtered products

        async function fetchProducts() {
            try {
                const response = await fetch('products.xml');
                const text = await response.text();
                const parser = new DOMParser();
                const xml = parser.parseFromString(text, "application/xml");
                const productElements = xml.getElementsByTagName("product");

                // Store all products in an array
                allProducts = Array.from(productElements).map(product => ({
                    id: product.getElementsByTagName("id")[0].textContent,
                    name: product.getElementsByTagName("name")[0].textContent,
                    type: product.getElementsByTagName("type")[0].textContent,
                    price: product.getElementsByTagName("price")[0].textContent,
                    ranking: product.getElementsByTagName("ranking")[0].textContent,
                    image: product.getElementsByTagName("image")[0].textContent,
                    description: product.getElementsByTagName("description")[0].textContent,
                }));

                filteredProducts = [...allProducts]; // Initially show all products
                displayProducts();
                generatePaginationLinks();
            } catch (error) {
                console.error("Error fetching products:", error);
            }
        }

        function displayProducts() {
            const productBox = document.querySelector(".product-box");
            productBox.innerHTML = ""; // Clear existing products

            const startIndex = (currentPage - 1) * productsPerPage;
            const endIndex = Math.min(startIndex + productsPerPage, filteredProducts.length);

            // Display products for the current page
            for (let i = startIndex; i < endIndex; i++) {
                const product = filteredProducts[i];
                const productDiv = document.createElement("div");
                productDiv.classList.add("product");
                productDiv.onclick = () => location.href = 'sproductpage.html?id=' + product.id;

                productDiv.innerHTML = `
                    <img src="${product.image}" alt="${product.name}">
                    <div class="description">
                        <span>${product.type}</span>
                        <h5>${product.name}</h5>
                        <div class="star">
                            ${'‚≠ê'.repeat(product.ranking)}
                        </div>
                        <h4>$${product.price}</h4>
                    </div>
                    <a href="#" class="cart-btn"><i class="fa-solid fa-cart-plus cart"></i></a>
                `;
                productBox.appendChild(productDiv);
            }
        }

        function generatePaginationLinks() {
            const pagination = document.getElementById("pagination");
            pagination.innerHTML = ""; // Clear existing pagination

            const totalPages = Math.ceil(filteredProducts.length / productsPerPage);

            // Generate links for each page
            for (let i = 1; i <= totalPages; i++) {
                const link = document.createElement("a");
                link.href = "#";
                link.textContent = i;
                link.onclick = (e) => {
                    e.preventDefault();
                    currentPage = i;
                    displayProducts();
                };
                pagination.appendChild(link);
            }

            // Add "Next" button if needed
            if (currentPage < totalPages) {
                const nextLink = document.createElement("a");
                nextLink.href = "#";
                nextLink.innerHTML = `<i class="fa-solid fa-long-arrow-alt-right"></i>`;
                nextLink.onclick = (e) => {
                    e.preventDefault();
                    if (currentPage < totalPages) {
                        currentPage++;
                        displayProducts();
                    }
                };
                pagination.appendChild(nextLink);
            }
        }

        function filterProductsByCategory() {
            const selectedCategory = document.getElementById("category-select").value;

            if (selectedCategory === "all") {
                filteredProducts = [...allProducts]; // Show all products
            } else {
                filteredProducts = allProducts.filter(product => product.type.toLowerCase() === selectedCategory.toLowerCase());
            }

            currentPage = 1; // Reset to the first page after filter
            displayProducts();
            generatePaginationLinks();
        }

        // Event listener for category filter change
        document.getElementById("category-select").addEventListener("change", filterProductsByCategory);

        document.addEventListener("DOMContentLoaded", fetchProducts);

    </script>
</body>
</html>
